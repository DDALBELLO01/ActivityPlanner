<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione attività - Reindirizzamento</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
</head>
<body>
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div style="text-align: center; color: white;">
            <h2>Reindirizzamento in corso...</h2>
            <div style="margin: 20px 0;">
                <div style="border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <script>
        // Inizializzazione Supabase
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Funzione principale di reindirizzamento
        async function redirect() {
            try {
                console.log('Caricamento iniziale del sito...');
                
                // Controlla se c'è un token di registrazione nell'URL
                const urlParams = new URLSearchParams(window.location.search);
                const registrationToken = urlParams.get('register');
                
                if (registrationToken) {
                    console.log('Token di registrazione trovato, reindirizzamento a register.html');
                    window.location.replace(`register.html?register=${registrationToken}`);
                    return;
                }
                
                // Per default, vai sempre al login come pagina iniziale
                console.log('Reindirizzamento alla pagina di login');
                window.location.replace('login.html');
                
            } catch (error) {
                console.error('Errore durante il reindirizzamento:', error);
                // Fallback al login
                window.location.replace('login.html');
            }
        }

        // Esegui il reindirizzamento con timeout di sicurezza
        document.addEventListener('DOMContentLoaded', function() {
            // Timeout di sicurezza per evitare che la pagina rimanga bloccata
            const timeoutId = setTimeout(() => {
                console.log('Timeout raggiunto, reindirizzamento forzato al login');
                window.location.replace('login.html');
            }, 3000); // 3 secondi di timeout
            
            redirect().finally(() => {
                clearTimeout(timeoutId);
            });
        });
    </script>
</body>
</html>
